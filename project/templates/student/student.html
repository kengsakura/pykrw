{% extends 'layout.html'%}
{% block content %}
{% load static %}
{% load humanize %}
{% load i18n thaidate %}
{% load crispy_forms_tags %} 
<style>
    a{
      text-decoration: none;
      font-size: 18px;
    }
    p{
      font-size: 16px;
    }
    h3{
        font-family: 'Mitr', sans-serif;
    }
    .m1{
    font-weight: bold;
    color: rgb(192, 15, 15);
}
.m2{
    font-weight: bold;
    font-size: 18;
    color: rgb(87, 20, 163);
}
.header {
  font-weight: bold;
    font-size: 16;
    color: rgb(14, 22, 97);
}

  </style>
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item active" aria-current="page"><a>รายชื่อนักเรียน</a></li>
  </ol>
</nav>
<div class = "card callout-top ">
  <div class = "container-fluid" align = "center">
<h3>รายชื่อนักเรียน</h3>
<hr>
{% for msg in messages %}
<div class="alert alert-{{ msg.tags }} alert-dismissible fade show" role="alert">
  {{msg}} 
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endfor %}
<a type="button" href = "{% url 'listroom' %}" class="btn btn-warning" >
  <i class="fas fa-list"></i> แสดงข้อมูลรายห้อง
</a>
<button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#importstudent">
  <i class="fas fa-file-import"></i> Import
</button>
<button type="button" class="btn btn-danger">
  <i class="fas fa-file-export"></i> Export
</button>
<!-- Modal -->
<div class="modal fade" id="importstudent" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">นำเข้ารายชื่อนักเรียน</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="POST" action="" enctype="multipart/form-data">
          {% csrf_token %}
          <input type = "file" name = "fileup">
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">import</button>
      </form>
      </div>
    </div>
  </div>
</div>

<div class="table-responsive">
  <table class="table table-hover table-sm" id = "myTable">
    <thead class="table-dark align-middle">
      <tr>
      <th style="width: 5%;">ที่</th>
      <th style="width: 10%;">เลขประจำตัว</th>
      <th style="width: 10%;">คำนำหน้า</th>
      <th>ชื่อ</th>
      <th>นามสกุล</th>
      <th style="width: 5%;">ชั้น</th>
      <th style="width: 5%;">ห้อง</th>
      <th>จัดการ</th>
    </tr>
    </thead>
    <tbody>
      {% for i in st_data %}
      <tr>
      <td>{{forloop.counter}}</td>
      <td>{{i.st_id}}</td>
      <td>{{i.title}}</td>
      <td>{{i.fname}}</td>
      <td>{{i.lname}}</td>
      <td>{{i.classroom}}</td>
      <td>{{i.room}}</td>
      <td><a class="btn btn-primary btn-sm"><i class="fas fa-eye"></i></a></td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
    </div>
</div>

{% endblock %}
{% block javascript %}
  <script>
    $(document).ready( function() {

// Save last active tab to sessionStorage
$('a[data-bs-toggle="tab"]').on('shown.bs.tab', function () {
    try {
        sessionStorage.setItem('lastTab', $(this).attr('href'));
    } catch (error) {
        console.log(error);
    }
});

// Get last active tab from sesssionStorage and go there
var lastTab = sessionStorage.getItem('lastTab');
if (lastTab) {
    $('[href="' + lastTab + '"]').tab('show');
}

});
    var triggerTabList = [].slice.call(document.querySelectorAll('#myTab a'))
triggerTabList.forEach(function (triggerEl) {
  var tabTrigger = new bootstrap.Tab(triggerEl)

  triggerEl.addEventListener('click', function (event) {
    event.preventDefault()
    tabTrigger.show()
  })
})
  $( document ).ready(function() {
    $('#changepicture').on("click",function(){
      var a= $('#changepic');
      if (a.css('display') == 'none'){
        a.css("display", "block");
      }
      else {
        a.css("display", "none");
      }
      
    });
});
    $(function () {

      /* SCRIPT TO OPEN THE MODAL WITH THE PREVIEW */
$("#id_path").change(function () {

  if (this.files && this.files[0]) {
    var reader = new FileReader();
    reader.onload = function (e) {
      
      $("#image").attr("src", e.target.result);
      $("#modalCrop").modal("show");
    }
    reader.readAsDataURL(this.files[0]);
  }
});

      /* SCRIPTS TO HANDLE THE CROPPER BOX */
var $image = $("#image");
var cropBoxData;
var canvasData;
$("#modalCrop").on("shown.bs.modal", function () {
  $image.cropper({
    autoCropArea: 0.5,
    viewMode: 1,
    aspectRatio: 3.2/4,
    minCropBoxWidth: 200,
    minCropBoxHeight: 200,
    ready: function () {
      $image.cropper("setCanvasData", canvasData);
      $image.cropper("setCropBoxData", cropBoxData);
    }
  });
}).on("hidden.bs.modal", function () {
  cropBoxData = $image.cropper("getCropBoxData");
  canvasData = $image.cropper("getCanvasData");
  $image.cropper("destroy");
});

// Enable zoom in button
$(".js-zoom-in").click(function () {
  $image.cropper("zoom", 0.1);
});

// Enable zoom out button
$(".js-zoom-out").click(function () {
  $image.cropper("zoom", -0.1);
});

      /* SCRIPT TO COLLECT THE DATA AND POST TO THE SERVER */
$(".js-crop-and-upload").click(function () {
  var cropData = $image.cropper("getData");
  $("#id_x").val(cropData["x"]);
  $("#id_y").val(cropData["y"]);
  $("#id_height").val(cropData["height"]);
  $("#id_width").val(cropData["width"]);
  $("#formUpload").submit();
});

    });
  </script>
{% endblock %}
